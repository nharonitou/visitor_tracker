{% extends 'layout.html' %}

{% block title %}Visitor Records{% endblock %}

{% block content %}
<h2 class="mb-4">Visitor Log</h2>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>ID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Type</th>
                <th>Host</th>
                <th>Department</th>
                <th>Branch</th>
                <th>Badge</th>
                <th>Check-In Time</th>
                <th>Check-Out Time</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% if visitors %}
                {% for visitor in visitors %}
                <tr>
                    <td>{{ visitor.VisitorID }}</td>
                    <td>{{ visitor.GuestFirstName }}</td>
                    <td>{{ visitor.GuestLastName }}</td>
                    <td>{{ visitor.VisitorType }}</td>
                    <td>{{ visitor.HostEmployeeName }}</td>
                    <td>{{ visitor.DepartmentVisited }}</td>
                    <td>{{ visitor.Branch }}</td>
                    <td>{{ visitor.BadgeNumber }}</td>
                    <td style="text-align: center;">{{ visitor.CheckInTime.strftime('%m/%d/%Y %I:%M %p') if visitor.CheckInTime else 'N/A' }}</td>
                    <td style="text-align: center;">{{ visitor.CheckOutTime.strftime('%m/%d/%Y %I:%M %p') if visitor.CheckOutTime else 'N/A' }}</td>
                    <td style="text-align: center;">
                        <span class="badge 
                            {% if visitor.Status == 'CheckedIn' %}bg-success
                            {% elif visitor.Status == 'CheckedOut' %}bg-secondary
                            {% else %}bg-warning{% endif %}">
                            {{ 'Checked In' if visitor.Status == 'CheckedIn' else 'Checked Out' }}
                        </span>
                    </td>
                    <td style="text-align: center;">
                        {% if visitor.Status == 'CheckedIn' %}
                        <form action="{{ url_for('checkout', visitor_id=visitor.VisitorID) }}" method="POST" class="checkout-form">
                            <button type="submit" class="btn btn-outline-danger checkout-btn" title="Check Out {{ visitor.GuestFirstName }}">
                                Out
                            </button>
                        </form>
                        {% else %}
                        <!-- Leave empty for checked out visitors -->
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            {% else %}
            <tr>
                <td colspan="12" class="text-center fst-italic py-4">
                    No visitor records found.
                </td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}
